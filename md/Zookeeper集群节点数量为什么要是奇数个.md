# ZooKeeper集群节点数量为什么要是奇数个？
原文链接：https://blog.csdn.net/u010476994/article/details/79806041

首先需要明确ZooKeeper的选举规则：**可用节点数 > 总节点数/2**，注意是 > 而不是 >=。

为什么要求 可用节点数 > 集群总结点数/2？
因为如果不这样限制，在集群出现脑裂时，可能会出现多个子集群同时提供服务的情况(当子集群分别选举出leader时)，这样对整个ZooKeeper集群来说就是紊乱的。换句话说，如果遵循上述选举规则，即使出现脑裂，集群最多只会出现一个子集群可以提供服务的情况(因为能满足节点数量>总结点数量/2的子集群最多只会有一个)。所以要限制 可用节点数量 > 集群总结点数量/2。

# 采用奇数个节点主要出于以下两方面的考虑：
### 1、防止由脑裂造成的集群不可用。
首先，什么是脑裂？集群的脑裂通常发生在节点间通信不可达的情况，此时集群就会分裂成多个小集群，每个小集群都选出自己的master节点，导致原有的集群出现多个master节点的情况，这就是脑裂。下面举例说明为什么采用奇数台节点就可以防止由于脑裂造成的服务不可用：
(1)、假如ZooKeeper集群有5个节点发生了脑裂，脑裂成了A、B两个小集群： 
(a) A：1个节点，B：4个节点（或A、B互换）
(b) A：2个节点，B：3个节点（或A、B互换）
可以看出，上面这两种情况下：A、B中总有一个小集群满足 可用节点数 > 总节点数/2，所以ZooKeeper集群仍能选举出leader，仍能对外提供服务，不过是有一部分节点失效了而已。
(2)、假如ZooKeeper集群有4个节点发生了脑裂，脑裂成了A、B两个小集群：
(a) A：1个节点，B：3个节点（或A、B互换）
(b) A：2个节点，B：2个节点
可以看出，情况(a)是满足ZooKeeper选举条件的，与(1)中的例子相同。但情况(b)就不同了，因为A、B都是2个节点，都不满足 可用节点数 > 总节点数/2 的选举条件，所以此时的ZooKeeper就彻底不能提供服务了。
综合上面两个例子可以看出：**在节点数量是奇数的情况下，ZooKeeper集群总能对外提供服务(即使损失了一部分节点)；但如果节点数量是偶数，就存在ZooKeeper集群不可用的可能(脑裂成两个均等的子集群时)。**在生产环境中，如果ZooKeeper集群不能提供服务，那将是致命的，所以ZooKeeper集群的节点数一般采用奇数个。

### 2、在容错能力相同的情况下，奇数台更节省资源。
leader选举要求 可用节点数 > 总节点数/2，注意是 > 而不是 >=。举两个例子：
(1) 假如ZooKeeper集群1有3个节点，3/2=1.5，即ZooKeeper想要正常对外提供服务(即leader选举成功)，至少需要2个节点是正常的。即3个节点的ZooKeeper集群，允许有一个节点宕机。
(2) 假如ZooKeeper集群2有4个节点，4/2=2，即ZooKeeper想要正常对外提供服务(即leader选举成功)，至少需要3个节点是正常的。即4个节点的ZooKeeper集群，也允许有一个节点宕机。
那么问题就来了，集群1与集群2都有允许1个节点宕机的容错能力，但是集群2比集群1多了1个节点。所以：**在相同容错能力的情况下，本着节约资源的原则，ZooKeeper集群的节点数为奇数更佳。**
